<style>
  .carget-acordion-color,
  .carget-acordion-disk,
  .carget-acordion-salon-color {
    width: 100% !important;
  }
</style>
<script>
  let savedSlides = {}
  let originalColorOptions = {}
  let originalWheelsOptions = {}
  let originalInteriorColorOptions = {}
  let previousModel = null

  let myTest
  const carState = {
    model: ['Zeekr 001 NEW', 'We'], // выбранная модель
    models: [
      // все модели, стоимости в юанях
      { We: { price: 269000, sale: 0 } },
      { We_4wd: { price: 269000, sale: 0 } },
      { Me: { price: 299000, sale: 0 } },
      { You: { price: 329000, sale: 0 } },
      {
        Performance: {
          price: 279398,
          sale: 0,
        },
      },
    ],
    // ОПЦИИ
    options: {
      color: [
        0,
        'ХАКИ', // названия как в каруселях alt
        [
          {
            price: 0,
            sale: 78000,
            color: 'ХАКИ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 78000,
            color: 'ОРАНЖЕВЫЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 78000,
            color: 'СИНИЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 0,
            color: 'БЕЛЫЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 0,
            color: 'СЕРЫЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 0,
            color: 'ЧЕРНЫЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 0,
            color: 'ЖЕЛТЫЙ',
            show: false,
            models: ['Performance'],
          },
        ],
      ],
      // ВЫБОР КОЛЕСА
      wheels: [
        0,
        '21” DOUBLE STAR',
        [
          {
            color: '21” DOUBLE STAR',
            diametr: 21,
            price: 0,
            sale: 208000,
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            color: '21” ARC PHANTOM',
            diametr: 21,
            price: 0,
            sale: 208000,
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            color: '22” MULTI SPOKE SPORT',
            diametr: 22,
            price: 260000,
            sale: 0,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            color: '20” PERFORMANCE FORGED С СУППОРТАМИ AKEBONO',
            diametr: 21,
            show: false,
            price: 0,
            sale: 0,
            models: ['Performance'],
          },
        ],
        true,
      ],
      // ВЫБОР ЦВЕТА САЛОНА
      interiorColor: [
        0,
        'СЕРЫЙ', // названия как в каруселях alt
        [
          {
            price: 0,
            sale: 0,
            color: 'СЕРЫЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 0,
            color: 'СЕРЫЙ С СИНЕЙ ПОЛОСОЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 0,
            color: 'БЕЖЕВЫЙ-СИНИЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 0,
            color: 'ЗЕЛЁНЫЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 0,
            color: 'СЕРЫЙ-БЕЖЕВЫЙ',
            show: false,
            models: ['We', 'We_4wd', 'Me', 'You'],
          },
          {
            price: 0,
            sale: 0,
            color: 'СЕРЫЙ-ОРАНЖЕВЫЙ',
            show: false,
            models: ['Performance'],
          },
        ],
      ],
      // ВЫБОР ДОПОЛНИТЕЛЬНОЙ ОПЦИИ
      runningBoards: [
        [
          // перечисления опций
          {
            price: 364000,
            sale: 0,
            show: false, //ВЫБОР ПО УМОЛЧАНИЮ
            title: 'ПНЕВМАТИЧЕСКАЯ ПОДВЕСКА',
            description:
              'Высота кузова меняется в диапазоне 117-200 мм, гибко адаптируясь к различным дорожным условиям',
            models: ['We', 'We_4wd'],
          },

          {
            price: 208000,
            sale: 0,
            show: false, //ВЫБОР ПО УМОЛЧАНИЮ
            title: 'ПАНОРАМНАЯ КРЫША ИЗ ЭЛЕКТРОХРОМНОГО СТЕКЛА ',
            description:
              'Цвет и рисунок стекла может варьироваться. Защита от ультрафиолета 99%',
            models: ['We', 'We_4wd', 'Me'],
          },

          {
            price: 208000,
            sale: 0,
            show: false, //ВЫБОР ПО УМОЛЧАНИЮ
            title: '4 СЕНСОРНЫЕ АВТОМАТИЧЕСКИЕ ДВЕРИ',
            description:
              'С ДАТЧИКАМИ ПРЕПЯТСТВИЙ И ЗАДНЯЯ ИНДУКЦИОННАЯ ДВЕРЬ С ПАМЯТЬЮ',
            models: ['We', 'We_4wd', 'Me'],
          },

          {
            price: 65000,
            sale: 0,
            show: false, //ВЫБОР ПО УМОЛЧАНИЮ
            title: '15.6 ДЮЙМОВЫЙ ПЛАВАЮЩИЙ ДИСПЛЕЙ',
            description: 'С интеллектуальным поворотным механизмом',
            models: ['We', 'We_4wd', 'Me'],
          },

          {
            price: 91000,
            sale: 0,
            show: false, //ВЫБОР ПО УМОЛЧАНИЮ
            title: 'ФАРКОП',
            description: 'Максимальная масса буксируемого прицепа 2 тонны',
            models: ['All'],
          },

          {
            price: 26000,
            sale: 0,
            show: false,
            title: 'КРЫША ЧЕРНОГО ЦВЕТА ',
            description: '',
            models: ['All'],
          },

          {
            price: 455000,
            sale: 0,
            show: false,
            title: 'ПАКЕТ Z-SPORT',
            description:
              'Оранжевый кузов, спортивные кованые диски R22, серо-оранжевый салон из алькантары, адаптивные гоночные сиденья',
            models: ['You'],
          },

          {
            price: 166400,
            sale: 0,
            show: false,
            title: 'ДОМАШНЯЯ ЗАРЯДКА 20 КВТ',
            description: 'ПРОВОД 30 МЕТРОВ',
            models: ['All'],
          },

          {
            price: 78000,
            sale: 0,
            show: false,
            title: 'ДОМАШНЯЯ ЗАРЯДКА 7 КВТ',
            description: 'ПРОВОД 30 МЕТРОВ',
            models: ['All'],
          },
        ],
        true, // если надо СКРЫТЬ то ставим false
      ],
    },
    delivery: {
      fromTurgartToBishkek: 1200, // Стоимость доставки из Тургарт в Бишкек в долларах
      customs: 4500, // Стоимость таможни в долларах
      otherExpenses: 1400, // Прочие расходы в долларах
      fromBishkekToRussia: 1200, // Стоимость доставки из Бишкека в РФ в долларах
    },
    labFees: 45000, // Стоимость лаборатории (СБКТС и ЭПТС) в рублях
    recyclingFee: 32600, // Стоимость утилизационного сбора в рублях
    carLocalization: 0, // Стоимость руссификации авто в рублях
    marga: [10, 2, 22], // Маржа в процентах (5%, 1.5%, 28%)
  }
  const data4 = [
    'Работаем за свои средства',
    'Белая и прозрачная структура договоров',
    'Официальные оплаты по счетам',
    'Быстрый возврат средств клиенту в случае нарушения условий договора',
    'Исключены таможенные риски',
    'Большой парк электромобилей в наличии в Москве',
    'Русификация авто и техническая поддержка',
  ]
  const data5 = [
    {
      img: 'https://carget.su/wp-content/uploads/2023/11/phone-icon.png',
      contact: '+7 996 410-01-87',
    },
    {
      img: 'https://carget.su/wp-content/uploads/2023/11/whatsapp-icon.png',
      contact: '+7 996 410-01-87',
    },
    {
      img: 'https://carget.su/wp-content/uploads/2023/11/telegram-icon.png',
      contact: '+7 996 410-01-87',
    },
    {
      img: 'https://carget.su/wp-content/uploads/2023/11/email-icon.png',
      contact: 'carget@bk.ru',
    },
  ]
</script>

<script>
  async function updateOptions(selectedModel) {
    if (selectedModel !== previousModel) {
      // Модель изменилась, выполняем обновление опций
      previousModel = selectedModel

      carState.options.color[2] = originalColorOptions
      carState.options.wheels[2] = [...originalWheelsOptions]
      carState.options.interiorColor[2] = [...originalInteriorColorOptions]

      carState.options.color[2] = carState.options.color[2].filter((option) =>
        option.models.includes(selectedModel)
      )
      carState.options.wheels[2] = carState.options.wheels[2].filter((option) =>
        option.models.includes(selectedModel)
      )
      carState.options.interiorColor[2] = originalInteriorColorOptions.filter(
        (option) => option.models.includes(selectedModel)
      )

      colorCarousel.swiper.removeAllSlides()
      colorImageCarousel.swiper.removeAllSlides()
      diskDiametr.swiper.removeAllSlides()
      colorSalon.swiper.removeAllSlides()
      salonImage.swiper.removeAllSlides()

      // Создаем пустые массивы для отслеживания уже добавленных слайдов для всех каруселей
      let addedColorSlides = []
      let addedColorImageSlides = []
      let addedDiskDiametrSlides = []
      let addedColorSalonSlides = []
      let addedSalonImageSlides = []

      // Проходим по каждой опции цвета кузова
      carState.options.color[2].forEach((option) => {
        if (option.models.includes(selectedModel)) {
          const isSlideAlreadyAdded = addedColorSlides.some((slide) =>
            slide.innerHTML.includes(`alt="${option.color}"`)
          )

          if (!isSlideAlreadyAdded) {
            const filteredColorSlides = savedSlides.colorCarousel.filter(
              (slide) => slide.innerHTML.includes(`alt="${option.color}"`)
            )

            filteredColorSlides.forEach((slide) => {
              colorCarousel.swiper.appendSlide(slide)
              addedColorSlides.push(slide)
            })
          }
        }
      })

      // Проходим по каждой опции цвета кузова
      carState.options.color[2].forEach((option) => {
        if (option.models.includes(selectedModel)) {
          // Фильтруем сохраненные слайды по цвету для colorImageCarousel
          const filteredColorImageSlides =
            savedSlides.colorImageCarousel.filter((slide) =>
              slide.innerHTML.includes(`alt="${option.color}"`)
            )

          // Создаем объект для хранения уникальных значений alt
          const uniqueAlts = {}

          // Проходимся по каждому отфильтрованному слайду
          filteredColorImageSlides.forEach((slide) => {
            // Получаем значение атрибута alt изображения
            const alt = slide
              .querySelector('.swiper-slide-image')
              .getAttribute('alt')

            // Если такого alt еще нет в объекте uniqueAlts, добавляем его в объект
            if (!(alt in uniqueAlts)) {
              uniqueAlts[alt] = true // Используем значение true для указания на уникальность
            } else {
              // Если такой alt уже есть, удаляем текущий слайд из DOM
              slide.remove()
            }
          })

          // Перебираем отфильтрованные и отфильтрованные от дубликатов слайды и добавляем их в карусель
          filteredColorImageSlides.forEach((slide) => {
            // Проверяем, добавлен ли уже этот слайд
            if (!addedColorImageSlides.includes(slide)) {
              colorImageCarousel.swiper.appendSlide(slide)
              addedColorImageSlides.push(slide)
            }
          })
        }
      })

      // Проходим по каждой опции диаметра диска
      carState.options.wheels[2].forEach((option) => {
        if (option.models.includes(selectedModel)) {
          const isSlideAlreadyAdded = addedDiskDiametrSlides.some((slide) =>
            slide.innerHTML.includes(`alt="${option.color}"`)
          )
          if (!isSlideAlreadyAdded) {
            const filteredDiskDiametrSlides = savedSlides.diskDiametr.filter(
              (slide) => slide.innerHTML.includes(`alt="${option.color}"`)
            )
            filteredDiskDiametrSlides.forEach((slide) => {
              diskDiametr.swiper.appendSlide(slide)
              addedDiskDiametrSlides.push(slide)
            })
          }
        }
      })

      // Проходим по каждой опции цвета салона
      carState.options.interiorColor[2].forEach((option) => {
        if (option.models.includes(selectedModel)) {
          const isSlideAlreadyAdded = addedColorSalonSlides.some((slide) =>
            slide.innerHTML.includes(`alt="${option.color}"`)
          )

          if (!isSlideAlreadyAdded) {
            const filteredColorSalonSlides = savedSlides.colorSalon.filter(
              (slide) => slide.innerHTML.includes(`alt="${option.color}"`)
            )

            filteredColorSalonSlides.forEach((slide) => {
              colorSalon.swiper.appendSlide(slide)
              addedColorSalonSlides.push(slide)
            })
          }
        }
      })

      // Проходим по каждой опции салона
      carState.options.interiorColor[2].forEach((option) => {
        if (option.models.includes(selectedModel)) {
          const isSlideAlreadyAdded = addedSalonImageSlides.some((slide) =>
            slide.innerHTML.includes(`alt="${option.color}"`)
          )

          if (!isSlideAlreadyAdded) {
            const filteredSalonImageSlides = savedSlides.salonImage.filter(
              (slide) => slide.innerHTML.includes(`alt="${option.color}"`)
            )

            filteredSalonImageSlides.forEach((slide) => {
              salonImage.swiper.appendSlide(slide)
              addedSalonImageSlides.push(slide)
            })
          }
        }
      })

      if (colorCarousel.swiper.slides.length > 1) {
        setTimeout(() => {
          // Обновляем все карусели
          colorCarousel.swiper.params.centeredSlides = true
          colorCarousel.swiper.params.slideToClickedSlide = true

          colorCarousel.swiper.update()
          colorImageCarousel.swiper.update()
          diskDiametr.swiper.update()
          diskImage.swiper.update()

          colorCarousel.swiper.slideTo(
            colorCarousel.swiper.params.slidesPerView
          )
        }, 1000)
      }

      areAllSlidesWithSameAlt(colorCarousel)
        ? removeDuplicateSlides(colorCarousel)
        : ''
      areAllSlidesWithSameAlt(colorImageCarousel)
        ? removeDuplicateSlides(colorImageCarousel)
        : ''
      areAllSlidesWithSameAlt(diskDiametr)
        ? removeDuplicateSlides(diskDiametr)
        : ''
      areAllSlidesWithSameAlt(colorSalon)
        ? removeDuplicateSlides(colorSalon)
        : ''
      areAllSlidesWithSameAlt(salonImage)
        ? removeDuplicateSlides(salonImage)
        : ''

      updateTitlePrice()
    }
  }

  function removeDuplicateSlides(carouselElement) {
    // Создаем объект для хранения уникальных значений alt
    const uniqueAlts = {}

    // Получаем все слайды карусели
    const slides = carouselElement.querySelectorAll('.swiper-slide')

    // Проходимся по каждому слайду
    slides.forEach((slide) => {
      // Получаем значение атрибута alt изображения
      const alt = slide.querySelector('.swiper-slide-image').getAttribute('alt')

      // Если такого alt еще нет в объекте uniqueAlts, добавляем его в объект
      if (!(alt in uniqueAlts)) {
        uniqueAlts[alt] = true // Используем значение true для указания на уникальность
      } else {
        // Если такой alt уже есть, удаляем текущий слайд из DOM
        slide.remove()
      }
    })
  }

  function areAllSlidesWithSameAlt(carousel) {
    const slides = carousel.querySelectorAll('.swiper-slide')

    if (slides.length === 0) {
      // Если карусель пустая, считаем, что все слайды с одинаковым alt
      return true
    }

    // Получаем значение атрибута alt первого слайда
    const firstSlideAlt = slides[0]
      .querySelector('.swiper-slide-image')
      .getAttribute('alt')

    // Проверяем, совпадает ли значение атрибута alt у всех слайдов
    for (let i = 1; i < slides.length; i++) {
      const slideAlt = slides[i]
        .querySelector('.swiper-slide-image')
        .getAttribute('alt')
      if (slideAlt !== firstSlideAlt) {
        // Если хотя бы одно значение отличается, возвращаем false
        return false
      }
    }

    // Если все значения атрибута alt одинаковы, возвращаем true
    return true
  }
</script>

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.3.0-beta.6/pdfmake.min.js"
  integrity="sha512-UKn7LIXGstEvDL3p8DcnxwBOLrIdfmOOWYfqanSRUccqhb9B+1piTS3PArWJJGfAxWrjHKg297qifN+2E9DORQ=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
  defer
></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.3.0-beta.6/vfs_fonts.min.js"
  integrity="sha512-HAlWj0XzCPx+89aKNPppxOHdIlfX8Sck6dhM6+6YVCNukOn4Ylqwpz0kbiUqwxasBqK7PbC/CjETOLMaF/N3jA=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
  defer
></script>
